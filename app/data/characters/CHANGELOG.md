# å¤‰æ›´å±¥æ­´ (Changelog)

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Honkai: Star Rail Simulatorã®é–‹ç™ºã«ãŠã‘ã‚‹é‡è¦ãªå¤‰æ›´ç‚¹ã¨ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

---

## 2025-12-26: ãƒˆãƒªãƒ“ãƒ¼çµç•Œãƒˆãƒªã‚¬ãƒ¼ä¿®æ­£

### çµç•Œä»˜åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»è»Œè·¡3ã‚¨ãƒãƒ«ã‚®ãƒ¼å›žå¾©ã®ãƒˆãƒªã‚¬ãƒ¼å¤‰æ›´

ãƒˆãƒªãƒ“ãƒ¼ã®çµç•Œã«ã‚ˆã‚‹ä»˜åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸ã¨è»Œè·¡3ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼å›žå¾©ãŒã€å›žå¾©ã‚„ãƒãƒ•ã‚¹ã‚­ãƒ«ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ãªã—ï¼‰ã§ã‚‚ç™ºå‹•ã—ã¦ã„ãŸãƒã‚°ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

**ä¿®æ­£å†…å®¹:**
- ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ `ON_ACTION_COMPLETE` ã‹ã‚‰ `ON_ATTACK` ã«å¤‰æ›´
- `ON_ATTACK` ã¯æ”»æ’ƒã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸Žãˆã‚‹è¡Œå‹•ï¼‰ã§ã®ã¿ç™ºç«ã™ã‚‹ãŸã‚ã€å›žå¾©ã‚„ãƒãƒ•ã‚¹ã‚­ãƒ«ã§ã¯ç™ºå‹•ã—ãªããªã‚Šã¾ã™

**ã‚¤ãƒ™ãƒ³ãƒˆã®é•ã„:**
| ã‚¤ãƒ™ãƒ³ãƒˆ | ç™ºç«æ¡ä»¶ | ç”¨é€” |
|---------|---------|------|
| `ON_ACTION_COMPLETE` | ã™ã¹ã¦ã®è¡Œå‹•å®Œäº†å¾Œ | è¡Œå‹•å®Œäº†æ™‚ã®å‡¦ç† |
| `ON_ATTACK` | æ”»æ’ƒã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ | æ”»æ’ƒæ¤œçŸ¥ï¼ˆçµç•Œä»˜åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸ç­‰ï¼‰ |

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/data/characters/tribbie.ts`

### å…‰å††éŒã€Œå¤§åœ°ã‚ˆã‚Šå¤©ã‚’ç›®æŒ‡ã—ã¦ã€ã®SPå›žå¾©ã‚«ã‚¦ãƒ³ãƒˆä¿®æ­£

ã‚µãƒ³ãƒ‡ãƒ¼ã®å…‰å††éŒã€Œå¤§åœ°ã‚ˆã‚Šå¤©ã‚’ç›®æŒ‡ã—ã¦ã€ã«ãŠã„ã¦ã€ã‚¹ã‚­ãƒ«/å¿…æ®ºæŠ€ã®ç™ºå‹•å›žæ•°ã‚«ã‚¦ãƒ³ãƒˆãŒæ­£ã—ãç´¯ç©ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã£ãŸå•é¡Œã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

**å•é¡Œç‚¹:**
- ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å‘¼ã³å‡ºã—æ™‚ã«æ¸¡ã•ã‚Œã‚‹ `unit` ã¯å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã‚ã‚‹ãŸã‚ã€åŒã‚¿ãƒ¼ãƒ³å†…ã§ã‚¹ã‚­ãƒ«â†’å¿…æ®ºæŠ€ã¨é€£ç¶šä½¿ç”¨ã—ãŸå ´åˆã€2å›žç›®ã®ã‚¤ãƒ™ãƒ³ãƒˆã§æœ€æ–°ã®ã‚«ã‚¦ãƒ³ãƒˆçŠ¶æ…‹ãŒå‚ç…§ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã£ãŸ

**ä¿®æ­£å†…å®¹:**
- `unit.effects` ã‹ã‚‰ç›´æŽ¥ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã‚’èª­ã¿å–ã‚‹ä»£ã‚ã‚Šã«ã€`newState.registry.get(createUnitId(unit.id))` ã§æœ€æ–°ã®ãƒ¦ãƒ‹ãƒƒãƒˆçŠ¶æ…‹ã‚’å–å¾—ã—ã¦ã‹ã‚‰ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/data/light-cones/a-grounded-ascent.ts`

---

## 2025-12-25: ã‚­ãƒ£ã‚¹ãƒˆãƒªã‚¹å¿…æ®ºæŠ€ä¿®æ­£ & å®‰å®šæ€§å‘ä¸Š

### ã‚­ãƒ£ã‚¹ãƒˆãƒªã‚¹å¿…æ®ºæŠ€ç™ºå‹•æ¡ä»¶ã®ä¿®æ­£
ã‚­ãƒ£ã‚¹ãƒˆãƒªã‚¹ï¼ˆ`max_ep: 0`ï¼‰ãŒè¡Œå‹•å€¤0ã§å¿…æ®ºæŠ€ã‚’é€£ç™ºã™ã‚‹å•é¡Œã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

**ä¿®æ­£å†…å®¹:**
- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ã® `checkAndExecuteInterruptingUltimates` é–¢æ•°ã«ãŠã„ã¦ã€`max_ep: 0` ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«å¯¾ã—ã¦å¾“æ¥ã®EPåˆ¤å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚
- ã‚­ãƒ£ã‚¹ãƒˆãƒªã‚¹å°‚ç”¨ã®ã€Œæ–°è•¾ã‚·ã‚¹ãƒ†ãƒ ã€åˆ¤å®šï¼ˆ`charge >= 34000`ï¼‰ã‚’è¿½åŠ ã—ã€æ–°è•¾ãŒä¸Šé™ã«é”ã—ãŸå ´åˆã®ã¿å¿…æ®ºæŠ€ãŒç™ºå‹•ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã€‚

### ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ã®å®‰å®šæ€§å‘ä¸Š
ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­ã«ãƒ¦ãƒ‹ãƒƒãƒˆãŒæ¶ˆå¤±ï¼ˆæ­»äº¡ãƒ»é€€å ´ï¼‰ã—ãŸå ´åˆã«ç™ºç”Ÿã™ã‚‹ `TypeError: unit is undefined` ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

**ä¿®æ­£å†…å®¹:**
- `stepSimulation` é–¢æ•°å†…ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã«ãŠã„ã¦ã€ãƒ¦ãƒ‹ãƒƒãƒˆå†å–å¾—æ™‚ã« `undefined` ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã€‚
- ãƒ¦ãƒ‹ãƒƒãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆã¯å®‰å…¨ã«ãƒ«ãƒ¼ãƒ—ã‚’ä¸­æ–­ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã€‚

### ã‚­ãƒ£ã‚¹ãƒˆãƒªã‚¹è¨­å®šé …ç›®ã®è¿½åŠ 
æ­»ç«œï¼ˆãƒœãƒªãƒ¥ã‚¯ã‚¹ï¼‰ã®ã€Œæ™¦å†¥ç„¼ãæ‰•ã†æ¯å¹ã€ç™ºå‹•å›žæ•°ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®è¨­å®šé …ç›®ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

**åˆ©ç”¨æ–¹æ³•:**
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆ`CharacterConfig`ï¼‰ã® `customConfig` ã« `siryuBreathCount` ã‚’æŒ‡å®šã—ã¾ã™ã€‚
```typescript
customConfig: {
    siryuBreathCount: 1 // ç™ºå‹•å›žæ•° (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1)
}
```

ã¾ãŸã€ãƒ‘ãƒ¼ãƒ†ã‚£ç·¨æˆç”»é¢ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è©³ç´°è¨­å®šã‹ã‚‰ã‚‚å¤‰æ›´å¯èƒ½ã§ã™ã€‚

---

## 2024-12-18: ãƒ€ãƒ¡ãƒ¼ã‚¸è©³ç´°ã‚’ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

è¡Œå‹•ãƒ­ã‚°ã®ã€Œãƒ€ãƒ¡ãƒ¼ã‚¸è©³ç´°ã€è¡¨ç¤ºã‚’ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°ã€ã«ãƒªãƒãƒ¼ãƒ ã—ã€ä¸Žãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ãƒ»å›žå¾©ãƒ»ã‚·ãƒ¼ãƒ«ãƒ‰ã‚’çµ±åˆè¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

### å¤‰æ›´ç‚¹
1. **`UnifiedDamageDetails` â†’ `UnifiedActionDetails`**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåã‚’å¤‰æ›´
2. **çµ±åˆè¡¨ç¤º**: ä¸Žãƒ€ãƒ¡ãƒ¼ã‚¸ã€è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ã€å›žå¾©ã€ã‚·ãƒ¼ãƒ«ãƒ‰ã®4ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’1ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«çµ±åˆ
3. **æ˜Žç¢ºãªåˆ†é¡ž**: å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è‰²åˆ†ã‘ã•ã‚ŒãŸãƒ©ãƒ™ãƒ«ã¨åˆè¨ˆå€¤ã‚’è¡¨ç¤º
   - ðŸ”´ ä¸Žãƒ€ãƒ¡ãƒ¼ã‚¸: ãƒ¡ã‚¤ãƒ³ãƒ’ãƒƒãƒˆ + ä»˜åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸
   - ðŸŸ  è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸: æ•µæ”»æ’ƒ / è‡ªå‚· / DoT
   - ðŸŸ¢ å›žå¾©: HPå›žå¾©è©³ç´°
   - ðŸŸ£ ã‚·ãƒ¼ãƒ«ãƒ‰: ã‚·ãƒ¼ãƒ«ãƒ‰ä»˜ä¸Žè©³ç´°

### å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `app/components/SimulationLogTable.tsx`
- `app/simulator/engine/simulation.ts`

### DoTãƒ€ãƒ¡ãƒ¼ã‚¸ã®ãƒ­ã‚°åˆ†é¡žä¿®æ­£

æ•µã®ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã«ç™ºå‹•ã™ã‚‹DoTãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæ„Ÿé›»ã€ç‡ƒç„¼ãªã©ï¼‰ãŒã€Œä¸Žãƒ€ãƒ¡ãƒ¼ã‚¸ã€æ¬„ã«è¡¨ç¤ºã•ã‚Œã¦ã„ãŸå•é¡Œã‚’ä¿®æ­£ã€‚

**ä¿®æ­£å†…å®¹:**
- æ•µã®ã‚¿ãƒ¼ãƒ³ã§DoTãŒç™ºå‹•ã—ãŸå ´åˆã€`appendDamageTaken` ã‚’ä½¿ç”¨ã—ã¦ã€Œè¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ã€ã¨ã—ã¦è¨˜éŒ²
- æ•µè¦–ç‚¹ã§ã¯ã€DoTã¯æ•µãŒã€Œå—ã‘ãŸã€ãƒ€ãƒ¡ãƒ¼ã‚¸ãªã®ã§è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸æ¬„ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ãŒæ­£ã—ã„

### å›žå¾©ãƒ»ã‚·ãƒ¼ãƒ«ãƒ‰ã®è¨ˆç®—å¼è¡¨ç¤º

å›žå¾©ã¨ã‚·ãƒ¼ãƒ«ãƒ‰ã«ã‚‚è¨ˆç®—å¼ã®å†…è¨³ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

**å¤‰æ›´å†…å®¹:**
1. `HealingEntry` ã¨ `ShieldEntry` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã« `breakdownMultipliers` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
2. `calculateHealWithBreakdown` é–¢æ•°ã‚’è¿½åŠ ï¼ˆå†…è¨³æƒ…å ±ä»˜ãå›žå¾©è¨ˆç®—ï¼‰
3. `applyHealing` ã¨ `applyShield` é–¢æ•°ã«å†…è¨³æƒ…å ±ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
4. `SimulationLogTable.tsx` ã«å›žå¾©ãƒ»ã‚·ãƒ¼ãƒ«ãƒ‰ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¿½åŠ 

**è¡¨ç¤ºå†…å®¹:**
- å›žå¾©: åŸºç¤Žå›žå¾©é‡ã€ä¸Žå›žå¾©ãƒãƒ•ã€å—å›žå¾©ãƒãƒ•ã€å›žå¾©ä¿‚æ•°ã€å‚ç…§ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¹ã€å€çŽ‡ã€å›ºå®šå€¤
- ã‚·ãƒ¼ãƒ«ãƒ‰: åŸºç¤Žã‚·ãƒ¼ãƒ«ãƒ‰å€¤ã€å‚ç…§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€å€çŽ‡ã€å›ºå®šå€¤ã€ä¸Šé™å€¤

### ã‚·ãƒ¼ãƒ«ãƒ‰è¨ˆç®—ã®ä¸€å…ƒåŒ–

**`applyShield`é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´:**
- ç¬¬4å¼•æ•°ã‚’ `shieldValue: number` ã‹ã‚‰ `shieldLogic: ShieldLogic` ã«å¤‰æ›´
- ã‚·ãƒ¼ãƒ«ãƒ‰è¨ˆç®—ã¨è¨ˆç®—å¼å†…è¨³ã®ç”Ÿæˆã‚’`applyShield`å†…éƒ¨ã§è‡ªå‹•å®Ÿè¡Œ
- ã™ã¹ã¦ã®ã‚·ãƒ¼ãƒ«ãƒ‰ã§è‡ªå‹•çš„ã«è¨ˆç®—å¼ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**æ–°ã—ã„ä½¿ç”¨æ–¹æ³•:**
```typescript
applyShield(state, sourceId, targetId, { scaling: 'def', multiplier: 0.24, flat: 320 }, 3, 'TURN_END_BASED', 'ãƒãƒªã‚¢');
```

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**
- `app/simulator/engine/utils.ts` - applyShieldé–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´
- `app/simulator/engine/dispatcher.ts` - stepApplyShieldæ›´æ–°
- `app/data/characters/dan-heng-permansor-terrae.ts` - å…¨ã‚·ãƒ¼ãƒ«ãƒ‰å‡¦ç†æ›´æ–°
- `app/data/characters/luocha.ts` - E2ã‚·ãƒ¼ãƒ«ãƒ‰æ›´æ–°
- `app/data/characters/march-7th.ts` - E2ã‚·ãƒ¼ãƒ«ãƒ‰æ›´æ–°

### å›žå¾©è¨ˆç®—ã®ä¸€å…ƒåŒ–

**`applyHealing`é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£å¤‰æ›´:**
- ç¬¬4å¼•æ•°ã‚’ `HealLogic | number` ã«å¤‰æ›´ï¼ˆå¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼‰
- `HealLogic`ã‚’æ¸¡ã—ãŸå ´åˆ: å›žå¾©è¨ˆç®—ã¨è¨ˆç®—å¼å†…è¨³ã‚’`applyHealing`å†…éƒ¨ã§è‡ªå‹•ç”Ÿæˆ
- `number`ã‚’æ¸¡ã—ãŸå ´åˆ: å¾“æ¥é€šã‚Šè¨ˆç®—æ¸ˆã¿å›žå¾©é‡ã‚’ä½¿ç”¨ï¼ˆå†…è¨³ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼‰

**æ–°ã—ã„ä½¿ç”¨æ–¹æ³•:**
```typescript
// æŽ¨å¥¨: HealLogicã‚’æ¸¡ã™ï¼ˆè¨ˆç®—å¼ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
applyHealing(state, sourceId, targetId, { scaling: 'atk', multiplier: 0.10, flat: 200 }, 'å›žå¾©', true);

// å¾Œæ–¹äº’æ›: è¨ˆç®—æ¸ˆã¿å›žå¾©é‡ã‚’æ¸¡ã™ï¼ˆè¤‡é›‘ãªå›žå¾©ãƒ­ã‚¸ãƒƒã‚¯ç”¨ï¼‰
applyHealing(state, sourceId, targetId, calculatedAmount, 'å›žå¾©', true);
```

**å¯¾å¿œæ¸ˆã¿ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:**
- `luocha.ts` - ã‚¹ã‚­ãƒ«ãƒ»çµç•Œå›žå¾©ã‚’`HealLogic`å½¢å¼ã«æ›´æ–°
- `blade.ts` - è‡ªå·±å›žå¾©ã‚’`HealLogic`å½¢å¼ã«æ›´æ–°

**å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ:**
- `hianshi.ts` - è¤‡é›‘ãªæ¡ä»¶ä»˜ãå›žå¾©ãƒ­ã‚¸ãƒƒã‚¯ã®ãŸã‚ã€è¨ˆç®—æ¸ˆã¿å›žå¾©é‡ã‚’æ¸¡ã™å½¢å¼ã‚’ç¶­æŒ


## 2024-12-16: CCåŠ¹æžœã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—ä¿®æ­£

è¡Œå‹•åˆ¶é™ãƒ‡ãƒãƒ•ï¼ˆå‡çµãƒ»ã‚‚ã¤ã‚Œãƒ»ç¦éŒ®ï¼‰ã®ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†é †åºã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

### å‡¦ç†é †åº
1. ä»˜åŠ ãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç†ï¼ˆå‡çµãƒ»ã‚‚ã¤ã‚Œï¼‰
2. åŠ¹æžœæ™‚é–“æ¸›å°‘ (`duration - 1`)
3. `duration > 0` â†’ ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ— / `duration <= 0` â†’ åŠ¹æžœè§£é™¤ã—ã¦é€šå¸¸è¡Œå‹•

### çµæžœ
- `duration: 1` ã§ä»˜ä¸Žã•ã‚ŒãŸåŠ¹æžœã¯ã€ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ã«è§£é™¤ã•ã‚Œã¦**é€šå¸¸è¡Œå‹•å¯èƒ½**
- `duration: 2` ä»¥ä¸Šã§ä»˜ä¸Žã•ã‚ŒãŸåŠ¹æžœã¯ã€ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—ãŒç™ºç”Ÿ

---

## 2024-12-16: å…‰å††éŒã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ä¿®æ­£

`lightConeHandlers.ts` ã§å…‰å††éŒã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å‡¦ç†ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

### å¤‰æ›´ç‚¹
- `cooldownTurns` ã¨ `maxActivations` ã‚’æ­£ã—ãå‚ç…§ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
- `lightConeState` ã‚’ãƒ¦ãƒ‹ãƒƒãƒˆã«ä¿å­˜ã—ã¦ç™ºå‹•å›žæ•°ã‚’è¿½è·¡
- `ON_TURN_START` ã§ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚’å®Ÿè£…

---

## 2024-12-16: ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—å¯¾å¿œè¡¨

`EVENT_REFERENCE.md` ã«ã€Œã‚²ãƒ¼ãƒ å†…èª¬æ˜Žæ–‡ã¨ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®å¯¾å¿œã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

ä¸»ãªå¯¾å¿œï¼š
- ã€Œæ”»æ’ƒã‚’è¡Œã£ãŸå¾Œã€â†’ `ON_ATTACK`
- ã€Œæ”»æ’ƒã™ã‚‹æ™‚ã€â†’ `ON_BEFORE_ATTACK`
- ã€Œå‘½ä¸­ã™ã‚‹æ™‚ã€â†’ `ON_BEFORE_HIT`
- ã€Œå‘½ä¸­ã‚’å—ã‘ãŸæ™‚ã€â†’ `ON_BEFORE_HIT` (targetId ã§åˆ¤å®š)

---

## 2024-12-16: æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—è¿½åŠ 

4ã¤ã®æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
è©³ç´°ã¯ [ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](EVENT_REFERENCE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- `ON_BEFORE_ACTION`
- `ON_BEFORE_ATTACK`
- `ON_BEFORE_HIT`
- `ON_AFTER_HIT`

---

## 2024-12-16: Action Value (AV) ç®¡ç†ã®å®Œå…¨ä¸€å…ƒåŒ–

`actionPoint` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå»ƒæ­¢ã•ã‚Œã€AVç®¡ç†ãŒå®Œå…¨ã«ä¸€å…ƒåŒ–ã•ã‚Œã¾ã—ãŸã€‚
è©³ç´°ã¯ [AVç®¡ç†ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](AV_MANAGEMENT.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### å¤‰æ›´ç‚¹
1. **`actionPoint` ã®å»ƒæ­¢**: `Unit` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰å‰Šé™¤ã€‚
2. **`setUnitActionValue` ã®å°Žå…¥**: AVã®ç›´æŽ¥è¨­å®šç”¨é–¢æ•°ã€‚
3. **`advanceAction`/`delayAction` ã®å†…éƒ¨å¤‰æ›´**: æ–°ã—ã„AVé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ›´æ–°ã€‚
4. **`recalculateActionValueFromActionPoint` ã®å‰Šé™¤**ã€‚

---

## 2024-12-15: EPå›žå¾©ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè£…

EPå›žå¾©æ™‚ã« `ON_EP_GAINED` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
è¨˜æ†¶ã®é–‹æ‹“è€…ã®ãƒãƒ£ãƒ¼ã‚¸ç²å¾—ãªã©ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

```typescript
// æŽ¨å¥¨ã•ã‚Œã‚‹ä½¿ç”¨æ³•
import { publishEvent } from '../../simulator/engine/dispatcher';
addEnergyToUnit(state, unitId, 5, 0, false, {
    sourceId: sourceId,
    publishEventFn: publishEvent
});
```

---

## 2024-12-12: ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚·ã‚¹ãƒ†ãƒ ã®å°Žå…¥

`state.units` ã®ç›´æŽ¥é…åˆ—æ“ä½œãŒéžæŽ¨å¥¨ã¨ãªã‚Šã€`state.registry` ã‚’ä½¿ç”¨ã—ãŸãƒžãƒƒãƒ—ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã«ç§»è¡Œã—ã¾ã—ãŸã€‚

### ç§»è¡Œã‚¬ã‚¤ãƒ‰

**éžæŽ¨å¥¨ (Deprecated):**
```typescript
const unit = state.units.find(u => u.id === id);
state.units = state.units.map(u => ...);
```

**æŽ¨å¥¨ (Recommended):**
```typescript
const unit = state.registry.get(createUnitId(id));
const newRegistry = state.registry.update(createUnitId(id), u => ...);
```
