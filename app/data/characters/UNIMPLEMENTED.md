# 未実装要素リスト

このファイルは将来実装予定の機能をまとめています。

---

## トリビー (Tribbie)

### 天賦のターゲット変更
**仕様**: 「追加攻撃を行う前に、ターゲットがすでに倒された場合、新たに登場した敵に追加攻撃を発動する。」

**現状**: 未実装。敵スポーン処理が実装されたタイミングで対応予定。

**必要な変更**:
1. 敵スポーン時に新規敵IDを追跡する仕組み
2. 追加攻撃発動前にターゲット生存チェック
3. 死亡時は新規敵に切り替え

---

## 敵スポーン処理

### ON_ENEMY_SPAWNED イベント
**現状**: イベントタイプは追加済み。`stepCheckEnemySpawn`がプレースホルダーとして存在。

**必要な変更**:
1. 敵スポーンロジックの実装（どのタイミングで敵が出現するか）
2. 新規敵ごとに `ON_ENEMY_SPAWNED` イベントを発火
3. トリビーの結界デバフを新規敵に適用（実装済み）

---

## ルアン・メェイ (Ruan Mei)

### E2: 攻撃力バフ ✅ 実装済み
**仕様**: 「ルアン・メェイがフィールド上にいる場合、弱点撃破状態の敵に対する味方全体の攻撃力+40%。」

**対応内容**:
1. `ON_BEFORE_DAMAGE_CALCULATION`イベントをsubscribesToに追加
2. ターゲットが弱点撃破状態（toughness <= 0）かを判定
3. `damageModifiers.atkBoost`を+40%

### 残梅: 発動タイミング ✅ 実装済み
**仕様**: 「敵が弱点撃破状態から**回復しようとする時**に残梅が発動する。」

**対応内容**:
1. `ON_WEAKNESS_BREAK_RECOVERY_ATTEMPT`イベントを追加
2. `simulation.ts`で敵のターン開始時に発火
3. 残梅ハンドラーで行動遅延・撃破ダメージ処理
4. ターンスキップ処理をsimulation.tsで実装

---

## 光円錐 (Light Cones)

### eternal-calculus.ts（絶え間ない演算）
**仕様**: 「攻撃を行った後、命中した敵**1体につき**、さらに攻撃力+4%。攻撃が**3体以上**の敵に命中した場合、自身の速度+8%。」

**現状**: ヒット数が1に固定されている。3体以上時の速度バフも未実装。

**必要な変更**:
1. `event.targetCount` プロパティのイベント構造への追加
2. ヒット数に基づく動的なスタック加算
3. 3体以上命中時の速度バフ付与

---

## 遺物 (Relics)

### longevous-disciple.ts（宝命長存の蒔者） ✅ 実装済み (2025-12-20)
**仕様**: 「装備キャラがHPを消費した時、または味方によってHPを消費させられた時、会心率+8%。」

**対応内容**:
1. `ON_HP_CONSUMED` イベントを追加し、HP消費を検知可能に修正。
2. 装備者自身のHP消費（スキル使用等）と、味方による消費を区別してトリガーするように実装。

### ninja-record-sound-hunt.ts（忍事録・音律狩猟） ✅ 実装済み (2025-12-20)
**仕様**: HP変化時に会心ダメージバフを付与。

**対応内容**:
1. `ON_UNIT_HEALED`（回復）、`ON_AFTER_HIT`（被ダメージ）、`ON_HP_CONSUMED`（消費）の3イベントをトリガーとして実装。
2. HP変化時に会心ダメージ+16%（2ターン、累積2層）を付与。



---



---

## 仕様確認が必要

### memorys-curtain-never-falls.ts（尽きぬ追憶）
**現状**: `all_type_dmg_boost` で実装。説明文がスキル限定を示唆している可能性あり。


---

## アナイクス (Anaxa)

### 昇華状態の行動制限
**仕様**: 「敵が行動制限抵抗を持たない場合、『昇華』状態での行動はできない。」

**現状**: 保留。敵行動シミュレーションが未実装のため。

**必要な変更**:
1. 敵行動処理の実装
2. 昇華状態の敵がターンをスキップするロジック
3. 行動制限抵抗の確認

---

## アベンチュリン (Aventurine)

### 行動制限系デバフ抵抗
**仕様**: 「アベンチュリンに『堅固なチップ』がある時、行動制限系デバフに1回抵抗できる。この効果は2ターン後に再度発動できる。」

**現状**: 保留。敵から味方への行動制限デバフ付与がシミュレートされていないため機能しない。

**調査結果**:
- 行動制限デバフ（凍結・もつれ・禁錮）は敵への付与は実装済み
- 敵の攻撃で味方にデバフを付与する処理が未実装
- 敵の行動はダメージのみで、状態異常付与能力がない

**必要な変更**:
1. 敵行動での味方へのデバフ付与ロジック
2. デバフ付与前の抵抗判定（効果抵抗 vs 付与率）
3. アベンチュリン専用の行動制限抵抗ロジック
4. 2ターンクールダウンの管理

---

## キャストリス (Castorice)

### トレースA4「反転した炬火」の死竜速度バフ

**仕様**: 「死竜が『晦冥焼き払う息吹』を発動し、フィールドにいるすべての敵にHPが0になるダメージを与えた時、または敵のHPがそれ以上削れない時、死竜の速度+100%、1ターン継続。」

**現状**: 保留。複数HPバーシステムが未実装のため。

**理由**:
- 「HPがそれ以上削れない時」はボスの複数HPバー（1本目→2本目移行時）を想定
- 現在のシミュレーターでは複数HPバーシステムが実装されていない

**必要な変更**:
1. ボスの複数HPバーシステムの実装
2. HPバー移行時の検知ロジック
3. 「すべての敵にHP0になるダメージ」の判定

---

## 効果命中/抵抗判定

✅ **2025-12-25: 全キャラクターで `checkDebuffSuccess` 関数への統合完了**

`checkDebuffSuccess`関数（dispatcher.ts）を使用して、以下のキャラクターのデバフ付与に効果命中判定を適用:

### 桂乃芬 (Guinaifen)
- 燃焼付与（通常・スキル）
- 火喰い付与（秘技・天賦）
- E1効果抵抗デバフ

### カフカ (Kafka)
- 感電付与（必殺技）
- E1持続ダメージ増加デバフ

### ブラックスワン (Black Swan)
- アルカナ付与（全箇所）
- 防御力ダウン（スキル）

### サイファー (Cipher)
- 虚弱デバフ（スキル・メイン・隣接）
- E2被ダメージ増加デバフ

### 三月なのか (March 7th)
- 凍結（秘技）

### 対象外としたキャラクター
以下は確定付与（`ignoreResistance: true`）やシステムデバフのため対象外:
- **黄泉** - 集真赤（システムデバフ）
- **トリビー** - 結界効果（システムデバフ）
- **アナイクス** - 弱点付与（`ignoreResistance: true`）
- **ブロニア** - E1 SP回復（固定確率、デバフ無し）
- **アベンチュリン** - E2耐性ダウン、動揺デバフ（確定付与）
- **ブートヒル** - 九死の決闘（確定付与）

---

## 更新履歴

- 2025-12-25: 全キャラクター効果命中判定統合完了（checkDebuffSuccess関数への統一）
- 2025-12-25: 桂乃芬実装、A6と効果命中判定を保留として追加
- 2025-12-24: キャストリス実装、A4の死竜速度バフを保留として追加

- 2025-12-23: アベンチュリン実装、行動制限系デバフ抵抗を保留として追加
- 2025-12-21: アナイクス実装、昇華状態の行動制限を保留として追加
- 2024-12-14: 装備検証レポートの未実装項目を追加
- 2024-12-13: 残梅のターンスキップを実装完了に変更
- 2024-12-13: ルアン・メェイのE2と残梅を追加
- 2024-12-10: 初版作成


